from main import (
    _image_cache_key,
    temp_image_exists_on_disk,
    _temp_image_path_for_key,
    _ext_for_mime,
    save_temp_image_and_get_url,
    set_image_flag_for_content,
)
from rtf_utils import extract_first_image_from_rtf, limpar_rtf
import base64
import os


RTF = r'''{\rtf1\deff0{\fonttbl{\f0 Calibri;}{\f1 Tahoma;}}{\colortbl ;\red0\green0\blue255 ;}{\*\defchp \fs22}{\stylesheet {\ql\fs22 Normal;}{\*\cs1\f1\fs20 Default Paragraph Font;}{\*\cs2\sbasedon1\f1\fs20 Line Number;}{\*\cs3\ul\fs22\cf1 Hyperlink;}{\*\ts4\tsrowd\fs22\ql\tscellpaddfl3\tscellpaddl108\tscellpaddfb3\tscellpaddfr3\tscellpaddr108\tscellpaddft3\tsvertalt\cltxlrtb Normal Table;}{\*\ts5\tsrowd\sbasedon4\fs22\ql\trbrdrt\brdrs\brdrw10\trbrdrl\brdrs\brdrw10\trbrdrb\brdrs\brdrw10\trbrdrr\brdrs\brdrw10\trbrdrh\brdrs\brdrw10\trbrdrv\brdrs\brdrw10\tscellpaddfl3\tscellpaddl108\tscellpaddfr3\tscellpaddr108\tsvertalt\cltxlrtb Table Simple 1;}}{\*\listoverridetable}{\info{\creatim\yr2021\mo12\dy27\hr8\min29}{\version1}}\nouicompat\splytwnine\htmautsp\sectd\pard\plain\ql{\lang1046\langfe1046\f1\fs20\cf0 Cliente Cancelou , nao vou concluir o atendimento pois exite uma rdm de melhoria.}\lang1046\langfe1046\f1\fs20\par\pard\plain\ql\lang1046\langfe1046\f1\fs20\par\pard\plain\ql{\*\shppict{\pict\pngblip\picw26092\pich6457\picwgoal14792\pichgoal3660\picscalex88\picscaley88 
89504e470d0a1a0a0000000d49484452000003da000000f4080600000064595e9c0000000467414d410000b18f0bfc6105000000097048597300000ec300000ec301c76fa864000032cd49444154785eeddd09b454d59deff1b7de7afd3a9d1ed283493a
9dd71989319a186d07445104058c38828a02325e447000441c5189035130ce2846443102220441051c5a19342ace1849a288464c40042ea368f2ecfebffbabb8799bedff54ddbab78aaabaf9fed7faacaa3a67ef7df619e0d48faa7bf91f1f7ef8a10100
00000080d2206803000000005042046d00000000004a88a00d00000000400911b401000000002821823600000000002544d00600000000a08408da00000000009410411b000000008012226803000000005042046d00000000004a88a00d000000004009
11b401000000002821823600000000002544d00600000000a08408da00000000009410411b008002962d5b66e79c734eee315d3e64c810ebd7af9f5d71c515b67efdfa1dd6a7b47edcb8719f19a7187ff8c31f72dbd2a3b7be9c76d6b69bb29d5ffef297
b9f3203a5771df78ddcd37dfdca83e9275de01002884a00d004006056305be8b2fbe38f718072e3dd7f262c22041bb719ab29db973e76eff870e0568f5d7ebf83c85f3a9f5f9fa8476de790700a03108da000014a0e09506647d321a025b6379e3146b67
855dcfceda7673b7a3e3abe3ace33d73e6cc9cb04ee72cfe543b88fb8465a5385f0080bf4c046d00000a4803975e2bac4d9c3871fb578fe3301753b00b6d34463a8e0265589f15dc357668a36dc621341e5fcb3566dc5ee2af456bde617998730899f7de
7b6f6eb9c659b16245ae9f5e87601a02b03e094ec708636b0c7d9d5ecbd3fdf3026e50ec3ea6fd637198d6637c5cbd402d719f406de2f305004063552468af5dbb16008092f3ee39a590062e054085d010ccf45a5f334e03995ec73fe3ab30a710aad7de
9871b80cd4270eca0aa4e1751a0eb52e0ebe1207cdf879bc7d09e138b40bdb90b06f7a9e6fbfb53c0461d1f3783e5a9fce4f9abb8f316f4e619f45cbd3a09df609d273546ade350c006819f8441b008002d2c0e505b334d0895ec7a1301e4763284c864f
6a2584f0780cf58fc755bf10c8b52eee2f71288db71f826fda5e6db4cd387caa4fdc2f9e73fa8f0171dbf818a88d5e873125dd4ea0fe4dddc798c68803bba4e7259d83d72788f73d5d0700403e046d00000a48039717c0d24027710895b85f1c26e33ea9
74dcb85f3a7e2c0d94f94263da361eb7d09ce3b6f15cd546afc398926e2768ea3ec6d45fe3a4cbd3fe71bbac3e41be630600403e046d00000af00297c25b08695aae4fb8e300ea2d57b08bbf3aae30592844aa8fda8570aaf6f1d7aabd4f63f53a0dc4a2
f97ac152f3696cd0d6f6b45dadd3ebacaf697bfba7f5defe36651f63eaa7b1bd36f1390873d298f9fa046a43d006003405411b008002b20297829abecaec7de53b50680c5f79d618f1380a790a91617d1c3663613b92fea2b0787c51888cdb4b1aeec3f2
1060b54ef30adbd6982110c7fbaeb6ea1f8f1182759867fc3add3fad0feb52c5ee63dc37dd8ec4e724ee1ff6ab501fc93aef00001442d00600000000a08408da00000000009410411b000000008012226803000000005042046d00000000004a88a00d00
000000400911b401000000002821823600000000002544d00600000000a08408da00000000009410411b000000008012226803000000005042046d00000000004a88a00d00000000400911b401000000002821823600000000002544d00600000000a084
08da00000000009410411b000000006ad4d6adfe72345f738e2d411b000000006acca64d1fdafafa6db676dd365bf301ca41c756c758c7da3b07f910b401000000a0866cdefc21017b27d2b1d631f7ce4516823600000000d4107dcaea0542948f8eb977
2eb210b401000000a046e8e786bd2088f2f3ce4716823600000000d4102f04a2fcbc739185a00d0000000035c40b81283fef5c64216803000000400df14220cacf3b175908da000000005043bc1088f2f3ce4516823600000000d4102f04a2fcbc739185
a00d0000000035c40b81283fef5c64216803000000400df14220cacf3b175908da000000005043bc1088f2f3ce4516823600000000d4102f04a2fcbc739185a00d0000000035c40b81283fef5c64216803000000400df1426053bcf8e2af6dd8f073728f
e9f2c1838758bf7efd6cf48fafb0952bebb7afd3f3abafbe76873ed7df704b4edc46fdd45fa64e9db97d9d47ebd3edc8f2e5ab6cf8f011f6c413bfdc61799035cf74fb59fd8be59d8b2c046d00000000a8215e082c4608a2175c7871ee310ecd7aaee50a
b9719f40a135846a3d57904d83b6c678fa972fe79e876d796137046505778983b6c653c8ceeaabf9699e61ee6a1f027d3c9f42fb530cef5c64216803000000400df142605328d87a9f4ee7fb04f8b6db26eed05ee2f0ed2934a6c64b837690d537dd6618
4381bad87d6a2cef5c64216803000000400df1426053a4415baf154a15a6c3d7aee3af7d2bc46a7d1a88f3056d2fcca78a09dae1b5e695ce4d9f7ebffcf26f77f8a43bf489db3695772eb210b401000000a0867821b029d210acb0aaaf6b87d0acd77168
4dc36d902f68ab7dd6baa094413bfc63405817f6c99b77b1bc739185a00d0000000035c40b814de1056defd360055bb5d573b509eb022f68abbd826f63026e31413bc817b443b8d627f27ad427f4de18c5f2ce4516823600000000d4102f0436451ab4d3
d71282ae17a683749d374e3e4d09dae936b3c628762ef978e7220b411b000000006a8817029bc20ba1fa943804582d0fbfb1dbfb2568411a7af5ba98af6a67856449837678ad39c59fbe6bb9b7cd787f9acb3b175908da000000005043bc10d814599ff6
2a98ea6bd7faafb7b44ea156cbbc202c69d056b80dbf4c2dc817769b12b4f55c8fdef8f1f6f36db758deb9c842d006000000801ae285c07252708dc3ee5f2aef5c64216803000000400df14220cacf3b175908da000000005043bc1088f2f3ce45168236
00000000d4102f04a2fcbc739185a00d0000000035c40b81283fef5c64216803000000400df14220cacf3b175908da000000005043bc1088f2f3ce4516823600000000d4102f04a2fcbc739185a00d0000000035c40b81283fef5c64216803000000400d
f14220cacf3b175908da000000005043bc10588c37df5c65a79edacf963cffbabbbe12d2398d1e3d26276d5749deb9c842d006000000801ae285c062d442d0ae46deb9c842d006000000801ae285c06210b49bc63b175908da000000005043bc10588c10
6a1f7974b11d73ecf1d6aa552b6bdbf6901d42eebb2beb6dc890b373ebd2f561ddb4fb666fefafaf79c77dd2f152e9f8e3c6ddb443d0be73d2941dbe3aaed7a1ad68ee61ddcee29d8b2c046d00000000a8215e082c8682b602b2e8b99685d0add72104c7
41d75b1f5e87f1e2709def67ac437f85e7b04c6de3fe71d056fb5bc6df917b0cebd43fbcde59bc739185a00d0000000035c40b81c550304ebfa61dc2af02b5966bbdda79ebe3e7617d1aacb52e2b0c7be3a7734a3fd18e79fd7706ef5c64216803000000
400df1426031bca02d0ab60ac8592159eb1580bda0ade5125ee70bdadeba42415b7de2af8ec79fc6ef2cdeb9c842d006000000801ae285c06278413b0ecf599f188720dedca0ed8daf65c71c739c1bb4d3b1b2e6576edeb9c842d006000000801ae285c0
6228a0ea13e1f8136305db106643904e3f514e7f46bba9413b6c3f6eaf6d65fd8c76fc3cbce6136d0000000040c97821b0180aa8fa4458bf602cebabd8214c7beb9b1bb42584ed30be7e8379fc297b1caed3b623cfbb884fb40100000000a5e38540949f
772eb210b401000000a086782110e5e79d8b2c046d00000000a8215e0844f979e7220b411b000000006a881702517edeb9c842d006000000801ae28540949f772eb210b401000000a086782110e5e79d8b2c046d00000000a8215e0844f979e7220b411b
000000006a881702517edeb9c842d006000000801ae28540949f772eb210b401000000a086782110e5e79d8b2c046d00000000a8215e0844f979e7220b411b000000006ac4d6ad04ed4af1ce4716823600000000d490f5f57e10447979e7220b411b0000
00006ac8e6cd1fdada757e1844f978e7220b411b000000006acca64d7ffe649bc0bdf378e7210b411b00000000801222680300b013e997d878cb010040cb41d006006027e02b7e0000d436effe9e85a00d004099f14b6b0000a87dde3d3e0b411b008032
e3bf610100a0f679f7f82c046d0000ca483f93edddac0100406df1eef35908da0000949977b3060000b5c5bbc767216803005066decd1a0000d416ef1e9f85a00d00409979376b0000505bbc7b7c168236000065e6ddac0100406df1eef15908da000094
9977b3060000b5c5bbc767216803005066decd1a0000d416ef1e9f85a00d0040997937eb62bcbbb2de860c39db8e39f6787bf3cd553bac5bf2fceb76eaa9fd76583e7af4186bdbf690dcba471e5d9c13f74175b973d294dcf9d579f6d617e25d03c5d235
d3aa55abdca3b73ed0b5d49cb9560bed87f63716fecc78ed6b85ae015d0be5da0f5dabdedf4329b52b742d49f8bb2dfc1da53e8de9d7d876a552eee35a6bd2e3b1b3cf472579f7f82c046d0000caccbb5917436f46479e77911d73cc71b937b0f1ba3464
e971fcf889b947bd216ecc9be252d31bae749e289ff41a285631e1b92505ed743f42f8aee56b57d740b902a1c61c37ee26775daaa941bb5a95f3b89643638f7f5355d3f128f7bea6bc7b7c168236000065e6ddac8b11de8cde32fe8e5cd88edfdce87973
42563910b477aee65e03c5bc516dc9415baaf1cf5331ca1980162d7ea1d1e79da05d5904edf2f1eef15908da0000949977b32e46fc66546f2ae2809006033dea53ecf075d8344c688cb04e0abd4189dba75fad55dfb04edb7973f9aadca3d73edf76d37d
90426f9ed447e387f1d45ecbc3b10acbe3398475d3ee9bbdfd18a5fba47142dff8db00e9b8e9dce27e5a27614ee9be84b142b8d0a35e6b797803ab3986fd4bbf95909e63fd034c7cfcf21d8394e615da89e692f68fb71fcf35bc8efba7e74173d3f6e33e
b1745b71bbf898c6634b9887c6d7bab08ff17cd273144bf72308f3d17abd4e8f75e8e3f5d7b270ace279483cf7703dc4c73eddb7acbea930dfd0569f38c701286bfee938a23ee19a93700c447308cb259d533c676d4ff3888f7f3a8fd03f3dde5a1ef74b
f72fcc3f6e97b609e7208c11cb9a87a4c73d9dbf8eabda84fef19fab3087f47acfb7bd54ba1ff1f89e74be61ecf8ba92706cf3cd251ccfb86fbc3e9d5b7a9d85fe7a1e8e55fc7798d6c7dbd7a35e87f1b3e616b69bf5777663f735dd5e7378f7f82c046d
0000caccbb591723bcd9d09b88f03cbc11d11b8e3864a94dfa6623bcd6a3f7e6307e431553fbf80d8a5eabbdfac5cfb52efeb44b6f7ee2310b6d37dd07d1baf0c62da5f6f127fbea377bcea3dbc78dfbc5fb10d6c7fba4b6613fd2793cffc2b21dfa85f9
86d71a5bafb53c8c11b6a93777a17dba2f697f3d86feda9ee6175e87b6a17f581ffa86f5e93e661d83b02c96ce4fc7416f6cf53c8c17f6259eab5e871f5308ebd279c46d53e9d8a2ed6ab996c573d663bcdf7a4c8fb15e87fd48af9154ba1f318d11ef6f
d8663c073d8f8346da2febb8e875986b18578ff19f8f7c7d63def1d31ce2b1d43f6c4763c4c73016c68adbeafad7738d1fcf211d478ff17a6d5b7308e7226dafd7e1d8a5dbd5b6423f6fffe2eb23b4d33859d76b2a3e476aabbfb7f45cdbcff77754d887
783fe3fd0eed45cfe33ede7eeb752cf40ffb24f1f871dba0d035168f55682e6a9f754da6c74234767cbce2ed856d8563a1366a1be6978e976f6ea16dbc6fda4e183bdd763c5e3c5f3d8ffb3487778fcf42d00600a0ccbc9b7531c29b8df046446f40f446
446f28e2e7693fd11b90f086237e1e68ccac3720697bb5d1cf8a6b9bea17bff989a5fd0a6dd7db07b557bfb84fe08d27de38f1b14b8f63da47cfbd70e68dab31340f6f4c89e798ee4bda478fe158681bda563c87787dfc3cac4ff721df3108cb62f98eb5
c4ebbded07f1dc0b6d53b2c6caea9b6f1eda667cee0a6d3f6bdb129fbb7cebe2f978e72d48d7c5fd24df5cf38dab65e9b9ced75eb2f62dcc215d9735b7781fbc31e3f5deb1d67a49c72fd42f88db15b34ecbbd755aa67ef1b278fbde718de79eee47da3f
2cd336d2ed88772ebd31b3a4f34b8f41a1b9a4ede36d37e63a8bfba7ebc258615b69fb7c73f38e413a9f782cf1c64be7d41cde3d3e0b411b008032f36ed6c5f0de6ce88d85a46f3a425b7d3a1164bd6191b47fe08d138431f4a8d7f1271ba279699bf138
f9b6ebcd217df314648d275aa6756a132f0ff3f1faa6dbd66bed8fb79f298df5daafdecef58ff75fe26390ee4b3a8f78de9a473a5ebcde3b2ef13ec46de336f17c52de987a1def6b589f8e1f1f2f09d742ba8f1e6fbbe21d0389b79dce437df43a9cc742
db4ffb0769bff03a3e16e138a6c73dde97ace3a275e97ea7dbccd737e6ed437aecf2cd3f15b70df32b742ec28f8b84b907f13eea79bcfd40ebd37d4ffbc5c72996aed3f374ecb87d2cb4d576b5fd740e81f6399cdface3a0b1d4cf1b23df7ec76388fa85
f9c4cbd556e3c4cb02cda5b1d758a1b9a4ede3fdf1e6961e8fb8bf77acb42e3d36f1b6b3e6e61d578d1bce4b3a96f75abc719acabbc767216803005066decdba18de9b04bdc9d027caf1cfe77aedf486436f3cd2e781deb4e853eaf84d54a0f68d7963a2
31e24f13d3ed14da6efac649bc374b81379e78e348d80feff864f509c7576de3b9c66dd2766159d84e9863ba2fe93cf4a8d75aaef1341f6d33b48fd7c7cfe3f5e1db05858e41bc2c48e7971edf787dbcfd745bf1dcd37df478fb22597df5da9b875e6bdb
7a1de65268fb59db8e977b63c4c7265eafe5a15dbee3a2d7f9ae87427d6369dbb02cfc592c34ff7cd44ebc3124ec73689b8e19faa76d53e9f859d75adc276da7c778fbf1ba7cd42e8c9f8e213a86e1cfbd771ee2b9a7fb21f9f63be59d4b51ff78cc206d
9fce2f3d0685e692b68ff7c79b9b96c57fe7c7fdbd6395ee47dc3edfdcbce39acec7dbd7705ec3323d0fdfc60acb9acabbc767216803005066decdba18de9b0dd16bfdcb7f0859e91b1cbdd63abd1109ede34f3dc2b8617d4aedc3d8e93afd4c64bc9d78
bb7ad3138f5968bb619e61ffd44eedb3de7ca5e3a97f313fa31db6231a23bc69d3f2b02e6e5be838697b5aaf767aad3e3a2ff1718f8fa3966b7dd8961e437fb549dfa4c6ebc3b1097dc3dcd27dcc3a0661594cf309ed43ff74fcb03e9e4bfc3cac0be725
1dc7a3f9685ef1712de667b4e36d6bbd5e87f685b69ff6176d33bdaef2fd79128da3c011ff434c3ab65ec7e3c6c75be2b916ea1bf3e6a37143fbc6cc3fd03afdcc6f781dcf51cff39d8b74bdb6a73984fe69fb58bcef7a1d6f37f48be79bfe8c76da3fbc
0e63c4b44eff30a947bd569f70acf53c3ece619cb0ed3097785cad0bfd43fb781ff3ed772af48fc757bff8b8c6e2b987d7f9aeb1427349dbc7fbe39d07b5cdda9edaa77f87695dbcedb47dd6dcbce3aa71c3dfd97a9db5aff17cf53c3e5ecde1dde3b310
b401002833ef665d0cefcd46a03718f19b31bda1085fbdd372f58bdf70688cb05ee2759e783c096f56d271d237427a1316bf112bb4dd78bdb6a137c4f19ba754d6f6c3b10acbe36353e84d5b9877e81bcf31bc790beb246b9b9ab7c4fdf53aacd7bec5f3
d0a35e6b1c6d277d931aafd7eb789e7a54f888df78e63b061ecd333ed6da5ee8abf11522c3fa782ee976f43ccc3dac0bfb98253daef13cd26b2f1e2b3d261a47afd36390b57d2d8fc79678db413c07efcf53987fbc2cdf710963c6db8ae75aa86f2a3d7e
e15a88b715d679f30fbced6a59581f8f23e9718dd7ab6ffae737be6645cfbdeb243d3659d747dc2e3e97e9f59ad2f2d056e386eb45d26b223e4e6aa7e3aafdf2faa7fb1164ed77dc2648cf413abf7c6df53c3eeff1710b73ca3797f4b8a7fb138f27de75
16fa876315efa7d6c5c726dd5ed6dcbce3aae51a3f1c1b6f5fd3f96a0c8d15c6680eef1e9f85a00d00409979376bb45cde9b43b44c5ea800d07279f7f82c046d0000caccbb59a3e5d2a735f93e8d42cba14fe5e24fe600b46cde3d3e0b411b008032f36e
d6683914acc357148590ddf2e9db0aa5fe4a2a80eae7dde3b310b401002833ef660d00006a8b778fcf42d00600a0ccbc9b350000a82dde3d3e0b411b008032f36ed6c558ba742900006826ef1e5b0cef1e9f85a00d0040997937eb62e8cd014551144551
4d2f823600002d8c77b32e06419ba2288aa29a57046d00005a18ef665d0c82364551144535af08da0000b430decdba18046d8aa2288a6a5e11b401006861bc9b753108da14455114d5bc22680300d0c27837eb62342668bff5d65b76e9a597dab66ddb3e
5db263cd983123c7abfafa7a1b3e7c78ee31ae254b9658ab56ad72ba75ebf699f5aaacbeda56e8abf5f1bce271a55dbb76b9f9a7a53eda27add3738d13fa64ed0b455114457945d00600a085f16ed6c52814b4c78e1d9b0b9f69a05529002b246785d310
88d320ad70dbb56bd7ed0158edd2f1b3faa66df55a730c95bece2a05f2308eda873e619fb49ea2288aa21a53046d00005a18ef665d8c7c413b04d03894868a03a9da28e0c61502f16bafbd667575759f09cb21d8aab44e6dd2e09df6d5f6b53c0ec15edf
742e5e85fd4afbabd2f95114455154be22680300d0c27837eb6214fa445be505edb8bca01d4a01b6505856796334a66fba2cdf5c42693cf5d1a3b76fe976298aa2282a5f11b401006861bc9b75316a2968abd4269e8bc6d157cce3a0add741ba1d95c650
3b95b76f046d8aa228aa9822680300d0c27837eb62d45ad056c5615abfd0cc1b4fa5fefa6568f13a6d3ffc123415419ba2288a6a6e11b401006861bc9b7531aa2968a7cb1a1378b54e6d42704e2bfef45aa576f16f50cf0adaf97ecb3a45511445c545d0
0600a085f16ed6c5d8d9415b95b6cf0acb5edfb40acd4ddb89b7956edbdb86d6c7e19ca2288aa2f215411b008016c6bb5917a312415bcb0afdf75eaa42415bcbe3ff8a4bfde7cd9b977bae4ab7a3f6da4e3a9ee61f82753a2645511445152a823600002d
8c77b32e462582b64a63869fb3ce1adbeb1bf79338106b0c8d15d6e9e7b343c856a9adf74975da2f1e93a2288aa20a15411b008016c6bb5917a33141bb255408d384688aa228aad445d00600a085f16ed6c5f84b09dafa649b5f704651144595a308da00
00b430decdba187f29419ba2288aa2ca55046d00005a18ef665d0c82364551144535af08da0000b430decdba18046d8aa2288a6a5e11b401006861bc9b7531f4e6000000348f778f2d86778fcf42d00600a0ccbc9b350000a82dde3d3e0b411b008032f3
6ed60000a0b678f7f82c046d0000caccbb59030080dae2dde3b310b4010028a3ad5b09da0000b404de7d3e0b411b0080325b5fefdfb00100406dd0bddcbbc7672168030050669b377f686bd7f9376e000050dd740fd7bddcbbc76721680300b0136cdaf4
e74fb609dc0000d406ddb375efd63ddcbbb7e743d00600000000a08408da00000000009410411b000000008012226803000000005042046d00000000004a88a00d00000000400911b401000000002821823600000000002544d00600000000a08408da00
000000009410411b000000008012226803000000005042046d00000000004a88a00d00000000400911b401000000002821823600000000002544d02ee0a38f3eb24f3ef9c4286a6794ae355d73deb508000000a03610b4f350e0a1a84a14611b000000a8
5d04ed3cf8249baa54e9daf3ae4900000000d58fa09d074555b2bc6b1200000040f52368e74151952cef9a0400000050fd08da79505425cbbb2601000000543f82761e1455c9f2ae4900000000d58fa09d074555b2bc6b1200000040f52368e74151952c
ef9a0400000050fd08da79505425cbbb260100000054bfaa0edaeb366eb1f9af7f60d73df99e9d3973859d70cf1bd66df29b3666c16a9bb274ad4d7cee7d7be3fdadf6e1b68fdcfecd4551952cef9a0400000050fdaa3268af5cb7d9263fffbe759bb2dc
7a4e5b6e67ce7ed7863eb4d286343cdeb164adbdb7f1637bb77e9bddffda3a7bfa9d8d0d41fbffdaba0d1fdbc62d1f37f4dff699f19a8aa22a59de3509000000a0fa555dd0ae6f08cbefacffd8a62cadb7d31e58698366bf67a7fe62a5f598bed26e7eee
035bb5f14fb67eeb9f6cf5c68fec57ab37dbf2755b6dc3e63fda9a86f0bdba217cafddb8cdd66ff6c72e164555b2bc6b1200000040f5ab9aa0bd71cb567b7bed567bf6dd7a5bf8ce267be0379becb40757d9c9f7ffde4e9ab1d2bacf7ccfc62c5e9d0bda
2bd77d682b1adabebfe1a35ce85ed9f0f8caaaadf6c8f20df6e85b1bed997737db13cbeb6df5fb6bdc6d35164555b2bc6b1200000040f5ab8aa0bd7ac3165bd410ae5f5db5c59e58b1d9ce9cf707eb376795f59eb3da7acd79df7ace5e6d831e7edfee7c
75832d7e778b3dfac6469bfd7abdfd66cd87f69bd5db6ce22bebecdc27d75addfc35d677de1a3bfdb175d66bde0776e3cc05f6e68a77dd6d3646a96aecd8b1367cf870dbb66ddba74b9a576fbcf1863dfef8e3f6c9279f7cbaa4fc3567ce1c1b3366cc67
f641cbfbf5eb97a3e771a9ed75d75d672b56acf87489d96db7dd96134aeb860c1992ebafc7b8ad57697f6d43f3ca9a43a8789ef2e28b2f7ebae6cf637acb2b5dde3509000000a0fa5524683ffef4223b73547f1b7e697febdcfb646bd7fd143be4e453ecdf5b1f61dfed70b47de3800eb6cb0f3bd8015dbbd9f517f7b797
afef65638edbdf461fbe9b8d3d7e1f1b3fe050bbae577bebd3664febd7fb583bf2d49ed6b36eb09dd2afceba9edac7ea4e1f6475757576d905c3ecce4beaecacc17dad5fff53ad779f536cf1e205ee9c3ccdadad5bb7daf3cf3f6f9d3a75b2458b16e596
e9b175ebd6b670e1c25c08d7d7c3f533db713df7dc73d6b973e7dcba50f1b210b4b76cd9920bb7e1abe30ae1cf3efbecf6afa1eb6bea5a3674e8d092076d3d6adb2194ea53e01080bd5f3c162a0dcaf9da7a95f6d76bef13e8ac009e6fde6acb6f1d0700
0000d05c1509dab7dc3dd14e397b90eddff5446bd510acbf7ad091b65ba7e3ec9ff73cccbeb0c7a1f6cdb687d93e471c6dfd460cb2d3079e64c33aed65fd0edacbc6743dd0ae3bf140ebbdfff76d4c973d6cd451fb5beb3df7b69e837bd84517f4b10963
87d96dd70eb349d79d6ff7df7c85cdbfe32a9b72e5409b7df3489b3dfe229b3ff1325bfac42c774e9ee694029dc2ad7e41d95d77ddb5fdffbcd6e3ac59b3ece0830fce7da55b9f542f5dbad47ef7bbdfe5bee6adaf92eb9798e997a0bdf3ce3b9f59a65f
9a1682b6b6a1b07df5d557e7b6137e199ab6317efc78db638f3d729f82df70c30d250fda2a05d273cf3d37f7b3da0aaf5aa7650aae59db8a83b2daa85ff825654108c15ea5415b4139ed1fb61f82763c4f8983793c87c6fc3fde3bb3bc6b1200000040f5
ab48d0ee73fe45b6f7d127dbb7da1d6bbbec73847d71df4ef6f5433bdb97f6ee609fdfb5ad7da77d47dbf3b04e76c2a081d6fb8423edc2ae87d9b08efbd9c0367bda651d7f68a38fd8db6e3ff900bbfff48e76c87776b36ffcf03fac43b7f65637f4581b
32e204bb7c547f9b75cb8536e58691366dcc409b7feb487b60dc709b3576882dbce71a774e1eaaf85288cd1794a9c697774d02000000a87e1509da470f18645fd9ff08db65af8ef6cf7b1e9efb24fb8b7bb5b7af1fd4d9fe759fc3ed73df3dc8fee17b6d
edab7bb7b5b6471c6e379dd5d3a69ed5d56eed71a84d3bed08bba7e741366f68479b37f268fbf62e5fb5c31adaec7b585beb705c3bdbabdd01f683b6fb59dd80ce3678c08f6cc6d5a7db33b70fb3c76e3adb1ebd75982d9c7c893b270f4555b2bc6b1200
000040f5ab48d03ea16e80fde0b0e3fefcb5f1038e6c08dd9d6c973ddbd997f66ad710badbdafffac67ef6bfbfb6bffdd5d7f6b57fdff3001bdca983cdb9b0affd7c50179b756e6f9b31b49b4dea75a0cd1ed6d0f7efbe685dba1c66479f78a475edd3c5
f63cf800fbfbafed6adffac10feda04e07e43ed19e7bdb407bf6e723ecc5a923ed9529a3dd397928aa92e55d9300000000aa5f4582f6fec79f64bb7738cabeb47727fbf25e87db370fe964df6c7398fde3ae073504ee83ed1fbe77a0fdc3ee07d85f7f6b
3ffbdbfff37debdfb68d9dd5fe009b3af478bbf2f8a3ed9ace6decfe2187dbf947b7b65d3ef7cfd6b6215cefd3a19d9dd0abb375e97e582e6c1ff0a3f6b6eb7e7bda357d3b588f135bdbcd63fbd9cf269c6e93279ce9cec94351952cef9a0400000050fd
2a12b4776fdfcdbe7640c79cafeed7c1bed010acfff1bbadedef776d78dce310fbfc77f6b7afef7f887d73bfb6f6837647dbede78fb41f7d77579b7cc6b176ffb9bd6ce65947d9aca19d6cb72f7ed9fee9afbf6067f4adb3137af4b0238e3fd4ba1c77a0
75edd1c13a1e73b0edf2ad6fd9e89e87da7fecfb5d3bbe473bbb72dcc9367e7c3f774e1e8aaa6479d72400000080ea5791a03d6cd408eb70e2f1765cefe3adf3295dec5baddbdabfef7ba07dfebb6d725f1bff76eb43ecf0ae5dedd6bba6daef7eb7ce96
2f7bd7c65f798b8dedd1c9ee19d8c926f73bc4ce3f740ffbfcfffc7bfbb7bff9173ba94b4f5bb460990d1b7691b53eb88d7ded7bdfb1bd0ffea17de57bbbd9b56776b3538ff9b65d3caa834dbce9207bf2c1d3dd397928aa92e55d9300000000aa5f4582
f6938f4fb2eb7edaa7214c77b46b7edccdaef9496fbbf28aee36eca2eeb6ef119deccbbbb7b1ff5cb8c47ef7de565bf4e41bf6c8f467ec813b7f61f75f7badfdac4f7bbbe5c47dede85dbffee7a0fdb95d6cd76f1f603fbbf379fbd9a4f9d6b17307dbfb
c0d6b6dbbebbdaf7f66d65f78cea6ef78dfb81dd38667f9b3db98d2d5dfc63774e1e8aaa6479d72400000080ea5791a0fdd2cb8fd98fc7f4b6b13fe9618f4deb6f77dedecb865fd8d5ceb9f068bb6cf40976e3f597dbda0d7fb2a797acb179d39fb287a7
3c66b36ebfcf1e9cf073bbeffaf176f1d187da6efff2aff6b77ff54ff6a5bff917dbf3fb1dec9ebb5fb1f9b35eb27b6ebbd25e78ea17f6debb6fd8d62d9b7356bebdd45e583cc1664cea62cb7f35db9d9387a22a59de3509000000a0fa552468af5fbf2e
f7df719dd0bd935d3fae97dd35a1ce2ebbe838eb72423b1b7551375bf0d854fbfdea8f6dde632b6cfef4c5b670c693f6f0e4876dd2adb36cca84997666cfb3ecfb7b1c6c5ff8dc3fda97ffeedfec9036c7daa43b9eb165cf3784ebad5bdd6dca962d9b6c
f3a67a779d87a22a59de3509000000a0fa552468cb35d75d65479dd8c14ee9dfd9fad6b5b76b2f39dcce197ab80d1fd6d59e7bee49fbf55b9b6dd69cd7edd1e94fd97f4e7bc4eebbf7597b60d6cbf6f0cfe7d94d6326d9ae5fdfdbbefe85af58abafef63
fd7a9e6f53a72cd83ef6faf5eb6dc18205367efcf81c3ddfb061c30edb6f0c8aaa6479d72400000080ea57b1a0bd62c56fec828b8eb0cb2eeb62e78ee868e78d6c672347b6b7be038eb0175e7ad15e7ebdde7e31eb255b38fd095b307d9ecd9df1b4cd7b
e0559b75fb4cbbe6dc2b6cf7af7cdbf6fac6eed6a5735fbbecdc6b6cf3e6cdb971972d5b6677dd7557c3f82b6cd3a64d397aae656fbdf5d667e6914fb96bc68c193676ecd84f5fb5acdab66d9b0d1f3edc962c59f2e992ea29cd4973d31c9b52ba8eba76
ed9a7b2c6779d72400000080ea57b1a02df7cdb8d1869cd9d1ce38fb303befdcf63668c84156775a3b5bb8e8297be68535b94fb09f9cb1c89ebe7fbe4dbe63813d70fff376ed7997dbe97d2eb2533a1e63a7b46f6dc71edcc6e64dff796e3c7d92ad40fd
f1c71f7f1a55fe7f6999d615f3c976b98ba05d996a6ed0de59e55d9300000000aa5f4583b65c7ef519f6a3aefbd931faffafbb1e60279edcc6e6ce7dc81e7fe839fbc5dd8fd993339fb645331fb7491317d9ac69afdad5e75f6327763cce861dd9da4677
6f6f57f5ec60abdffe4d6e2c7d455c9f5eaba64e9d6a1f7cf0418e9eabb44e6dd23964297711b42b53046d00000000e554f1a0fdab65afd95e6df6b2fd5aef6efbb6ded3bebff7ee76655d779b72fa4976679f236c4a9f4e3673445fbbfbae676df6d425
f6ec9c676cd6842976e589adedc2a3dad8bc0b0eb6ad5b36e5c6d2cf63874fb315b0f509b6e8b94a5f23579b740e594a512170b66ad52a270ed669d0aeafafb76eddba6d6fabf5a1f43c2c571bb5f52add5e0894e9d871d00cc173f2e4c9dbd7a7ff00a0
36619d84009d35e7308fd02e9d57bc0f61fb975e7ae9f6b11bd33eccb75dbb76b9af716b79689fef1f30d2fe5efb78ac74bde6515757b7fdabe3e95cf36dbb98f2ae4900000000d5afe2415b163dbdd80eeeb09f7d638f6fdba1edf7b127eeb8c01e386f
804dea7d98dddbe3609b56d7d9e6def5b03d7ddf3c7b79c6033671e4d976eb59c75addd19dedcebefbd896cdd519b44300cb0a9f71d00e8135ac8bc39ce879089afa643e3c8f2bdd9e6adebc79b9e51a371e3bde961e1510433f6d4fe1355e1f075dad7f
edb5d73e338e5e8739a7fbaa659a8b2a9d67d87e68ab6a4cfbf05a8f71c055df7c3f439df657bb747f437857a5dbf7f633ac4bf7bb39e55d9300000000aa5f55046d59fadaab76d565bdedda4bba3604ed91f6d4b5e73704ed8e36f5d4b63673c891f6c4
dd53ecf9d90fd93393a7db1d670db52b4e3bdd7a74ee62b79c77b6bdbd7c456e8cc67c75fce9a79ffeccb6b334b714c4e280ac52000b8150e12c3cd772053405b5505a2f1aa731bf7ccb1b23abb4dd100ebd7e617dbee0986fcef9faa9d426dfbea795af
7d7a7c0a6ddbdb5e7c3ce2e7a1e23e71d0967ce7b839e55d9300000000aa5fd504ed60e1bc89366ffc99b6e4e68bedae3e9d6c5aef436cf6d0e36dde84bbedb189536dfec429f6c08d77daed97fed46ebbf2369bf0d35fd86b2fbf9deb5be897a1dd7df7
dd3bf597a12970e993d354086c7178d473af6d58af40a74f59b52c2b40c6e3a515c2673c760893f982671c2ad3ca37e7b0bd78ae5a9eb65379db5735b6bde6a8d721ec7adb8e2bdffe66f58d03757c4cd42e9e63a0319a5bde3509000000a0fa555dd096
b5efadb07717ceb169671e67d3fb1e6ad3cfec6eb75f3ec926df30dbee99f084dd3371a14db973b13d3c7da9cd99fa9cdd7cfbe2edffbdd76f7ffbdb5cd8d6a7d7f17fefa590ad60946e2b9fe696b6a79f3b4e0364a838182bb085e7f94a212ffeba765c
5e805479e131044b95d7af50f0546959d69cd37ef1f654e9be676d3f54bef6a50cdae9f350f1b98c8376a173dc9cf2ae4900000000d5af2a8376b0a97ebdbdb1e0217b61fa3df6f894276dcaad8fdafd772eb047ee7fc5664f5f66f7cff88dcd79e2f7f6
ec4befdaa68d1bb7f7d3a7d6fa1ab97e1e5bf4bc984fb283e656087c69680b1587c742013a2ccf1722c318f1f6f473ceab56addae153e9b45da1e0a947b50f4156e3783fa31d573ccf74cee17556702eb6bde6a1d7617e69ffb4d2feaa787fb5bea93fa3
5dcaf2ae4900000000d5afaa8376a595a242188dbf561c02a0c259088f2a05b7f0f57009612f5d9e2fd4a5db0be3ab4f58a6f571382c143c5571ff388466cd390dbb7a8cdbe853e0ace0ac2aa67da983b62adebec4ebe2a01d5e679de3e694774d020000
00a87e04ed3c28ca2b056c05ed10eccb55de3509000000a0fa11b4f3a028aff4e976f874bd9ce55d9300000000aa1f413b0f8a8a2b7c7d5e5f132ff7a7d92aef9a0400000050fd08da79505425cbbb2601000000543f82761e1455c9f2ae4900000000d5
8fa09d074555b2bc6b1200000040f52368e74151952cef9a0400000050fd08da79505425cbbb2601000000543f82761e1455c9f2ae4900000000d58fa09d074555b2bc6b1200000040f52368e74151952cef9a0400000050fd08da79505425cbbb260100
0000543f82761e9f7cf2c9a79187a2766ee9daf3ae4900000000d58fa09dc7471f7df469eca1a89d5bbaf6bc6b1200000040f5236817a0c0c327dbd4ce2a5d6b846c000000a0b611b401000000002821823600000000002544d00600000000a08408da00
000000009410411b000000008012226803000000005042046d00000000004a88a00d00000000400911b401000000002821823600000000002544d00600000000a08408da000000000094cc87f6ff00f4198fc77d97f4170000000049454e44ae426082}}'''


def main():
    print("[INFO] Calculando chave para o RTF fornecido (atendimento 1110195)")
    # usar o RTF bruto para calcular a chave (é o que o UI faz)
    key = _image_cache_key(RTF)
    print(f"key={key}")

    present = temp_image_exists_on_disk(key)
    print(f"exists on disk: {present}")

    # tentar extrair a primeira imagem do RTF
    try:
        img_b, mime = extract_first_image_from_rtf(RTF)
    except Exception as e:
        print(f"extract_first_image_from_rtf error: {e}")
        img_b, mime = None, None

    print(f"extracted bytes: {len(img_b) if img_b else 0} mime={mime}")

    if img_b and mime:
        path = _temp_image_path_for_key(key, _ext_for_mime(mime))
        print(f"expected path: {path}")
        if not path.exists():
            print("file not on disk — saving now")
            url = save_temp_image_and_get_url(key, img_b, mime)
            print(f"save returned: {url}")
        else:
            print("file already present on disk")
        set_image_flag_for_content(RTF, True)
    else:
        print("no image extracted; setting flag to False")
        set_image_flag_for_content(RTF, False)


if __name__ == "__main__":
    main()
